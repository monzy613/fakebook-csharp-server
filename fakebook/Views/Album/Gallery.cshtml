<!doctype html>
<html class="no-js">
<head>
    @using fakebook.Models
    @model photoComment
    <meta charset="UTF-8">
    <title>Text | FakeBook</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="format-detection" content="telephone=no">
    <meta name="renderer" content="webkit">
    <meta http-equiv="Cache-Control" content="no-siteapp" />
    <!--link rel="alternate icon" type="image/png" href="assets/i/favicon.png"-->
    <link rel="stylesheet" href="@Url.Content("~/Assets/css/amazeui.min.css")" />
    <link rel="stylesheet" href="@Url.Content("~/Assets/css/admin.css")" />
    <style>
        .header {
            text-align: center;
        }

            .header h1 {
                font-size: 200%;
                color: #333;
                margin-top: 30px;
            }

            .header p {
                font-size: 14px;
            }

        #borderColorCorner {
            border: 10px solid #dedede;
        }

        padding: 15px 25px; 　　 height: inherit; 　　 width: 590px; 　　
        }
    </style>
</head>
<body>
    <header class="am-topbar admin-header" style="background-color: #1E5B94">
        <button class="am-topbar-btn am-topbar-toggle am-btn am-btn-sm am-btn-success am-show-sm-only" data-am-collapse="{target: '#topbar-collapse'}"><span class="am-sr-only">导航切换</span> <span class="am-icon-bars"></span></button>
        <div class="am-collapse am-topbar-collapse am-u-md-6" id="topbar-collapse">
            <ul class="am-nav am-nav-pills am-topbar-nav am-topbar-middle admin-header-list">
                <li>
                    <a href="../Account/UserPage">
                        <span class="am-icon-man-o" style="color:#000; font-size: 18px;font-family:'微软雅黑'">
                            主页
                        </span>
                    </a>
                </li>
                <li>
                    <a href="../Account/Text">
                        <span class="am-icon-man-o" style="color:#000; font-size: 18px;font-family:'微软雅黑'">
                            朋友圈
                        </span>
                    </a>
                </li>
                <li>
                    <a href="Gallery">
                        <span class="am-icon-man-o" style="color:#000; font-size: 18px;font-family:'微软雅黑'">
                            相册
                        </span>
                    </a>
                </li>
                <li>
                    <a href="../Topic/Index">
                        <span class="am-icon-man-o" style="color:#000; font-size: 18px;font-family:'微软雅黑'">
                            话题
                        </span>
                    </a>
                </li>
                <li>
                    <a href="../Account/Chatroom">
                        <span class="am-icon-man-o" style="color:#000; font-size: 18px;font-family:'微软雅黑'">
                            多人聊天室
                        </span>
                    </a>
                </li>
                <li>
                    <a href="../Account/PeopleAround" style="color:#000; font-size: 18px;font-family:'微软雅黑'">
                        <span class="am-icon-man-o">
                            附近的人
                        </span>
                    </a>
                </li>
                <li>
                    <a href="#friend-side-bar" data-am-offcanvas>
                        <span class="am-icon-man-o" style="color:#000; font-size: 18px;font-family:'微软雅黑'">
                            小伙伴们
                        </span>
                    </a>
                </li>

            </ul>
            <form class="am-topbar-form am-u-md-4 am-u-sm-10">
                <div class="">
                    <div class="am-input-group am-input-group-primary">
                        <span class="am-input-group-btn">
                            <a href="Search"><button class="am-btn am-btn-primary search-button" type="button"><span class="am-icon-search"></span></button></a>
                        </span>
                    </div>
                </div>
            </form>



        </div>


    </header>







    <div class="am-cf admin-main">

        <!-- content start -->
        <div class="admin-content">

            <div class="am-cf am-padding">
                <div class="am-fl am-cf"><strong class="am-text-primary am-text-lg">相册</strong> / <small>Gallery</small></div>
                <input type="button" class="picture-upload-button am-btn am-btn-primary am-fr" value="新照片" data-am-modal="{target: '#upload-madal', closeViaDimmer: 0, width: 400, height: 225}">
            </div>



            <div class="am-modal am-modal-no-btn" tabindex="-1" id="upload-madal">
                <div class="am-modal-dialog">
                    <div class="am-modal-hd">
                        上传照片
                        <a href="javascript: void(0)" class="am-close am-close-spin" data-am-modal-close>&times;</a>
                    </div>
                    <div class="am-modal-bd">
                        <form action="/galleryUploader" method="post" enctype="multipart/form-data">
                            <input class="am-btn am-btn-primary" type="file" name="" id="uploader">
                            <input type="submit" class="am-btn am-btn-primary upload-comfirm-button">
                        </form>
                    </div>
                </div>
            </div>
            <div>

                <ul data-am-widget="gallery" class="am-gallery am-avg-sm-2
  am-avg-md-3 am-avg-lg-4 am-gallery-bordered" data-am-gallery="{  }">
                    @foreach (var l in ViewBag.models)
                    {

                        <li>

                            <div class="am-gallery-item">

                                <img src=@l.Firstphoto class="i" />
                                <h3 class="am-gallery-title">@l.AlbumName</h3>
                                <div class="am-gallery-desc">2375-09-26</div>

                                <form action="Photoshow" method="post"><button name="id" value=@l.AlbumId type="submit" class="am-btn am-btn-primary am-u-sm-9">GalleryName</button></form>
                                <button class="am-btn am-btn-danger am-u-sm-3 ">del</button>
                            </div>
                        </li>
                    }
                </ul>
            </div>
        </div>
        <!-- content end -->

    </div>

    <footer class="footer">
        <br />
        <hr>
        <p class="am-padding-left" align=center>fakebook Tongji</p>
    </footer>

    <!--[if lt IE 9]>
    <script src="http://libs.baidu.com/jquery/1.11.1/jquery.min.js"></script>
    <script src="http://cdn.staticfile.org/modernizr/2.8.3/modernizr.js"></script>
    <script src="assets/js/polyfill/rem.min.js"></script>
    <script src="assets/js/polyfill/respond.min.js"></script>
    <script src="assets/js/amazeui.legacy.js"></script>
    <![endif]-->
    <!--[if (gte IE 9)|!(IE)]><!-->
    <script src="file:///C|/Users/Hasee/Desktop/QQrecive/assets/js/jquery.min.js"></script>
    <script src="file:///C|/Users/Hasee/Desktop/QQrecive/assets/js/amazeui.min.js"></script>
    <!--<![endif]-->
    <script src="file:///C|/Users/Hasee/Desktop/QQrecive/assets/js/app.js"></script>
    <script src="/socket.io/socket.io.js"></script>
    <script>
        var socket = io();
        socket.on('connect', function () {
            socket.emit('getGallery', { some: 'gallery' });
        });
        var gallery = [];

        function send(src) {
            var albumID = src.getAttrubute("data-id");
            $.post(Photoshow, albumID, function () { });

        }
        socket.on('getGalleryFromServer', function (data) {
            console.log(data);
            gallery = data;
            var tmpArr = [];
            var prefix = "";
            if (gallery.length !== 0) {
                tmpArr = gallery[gallery.length - 1].split('/');
                prefix = "" + parseInt(tmpArr[tmpArr.length - 1].split('_')[0]) + 1;
            } else {
                prefix = "0";
            }
            var newFileName = prefix + '_<%=username%>';
            uploader = document.getElementById('uploader');
            uploader.setAttribute('name', newFileName);
            console.log("newFileName: " + newFileName);
            initGallery();
        });


        function delPhoto(photoToDelete) {
            $.post('/deletePhoto', { photoToDelete: photoToDelete });
            location.reload(true);
        }

        function addPicture(image) {
            td = document.getElementById('gallery-list');
            var li = document.createElement('li');
            var a = document.createElement('a');
            var img = document.createElement('img');
            img.setAttribute('class', 'am-img-thumbnail am-img-bdrs am-u-sm-12');
            img.setAttribute('src', image.imgPath);

            var titleButton = document.createElement('button');
            titleButton.innerHTML = image.imgName;
            titleButton.setAttribute('class', 'am-btn am-btn-primary am-u-sm-6');

            var delButton = document.createElement('button');
            delButton.setAttribute('class', 'am-btn am-btn-danger am-u-sm-6');
            delButton.setAttribute('onclick', 'delPhoto("' + image.imgPath + '")');
            delButton.innerHTML = '删除/del';

            a.appendChild(img);
            a.appendChild(titleButton);
            a.appendChild(delButton);
            li.appendChild(a);
            td.appendChild(li);
        }


        function extension(filename) {
            var tmpArr = filename.split('.');
            alert(tmpArr[tmpArr.length - 1]);
        }

        function initGallery() {
            for (var i in gallery) {
                addPicture({ imgPath: gallery[i], imgName: ('img' + i) });
            }
        }
    </script>
</body>
</html>
